<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title></title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Overview</a></li><li class="chapter-item expanded "><a href="introduction/index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="exception_handling/index.html"><strong aria-hidden="true">2.</strong> Exception Handling</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="exception_handling/hardware_interrupt.html"><strong aria-hidden="true">2.1.</strong> Hardware Interrupt</a></li><li class="chapter-item expanded "><a href="exception_handling/exception.html"><strong aria-hidden="true">2.2.</strong> Exception</a></li><li class="chapter-item expanded "><a href="exception_handling/system_call.html"><strong aria-hidden="true">2.3.</strong> System Call</a></li></ol></li><li class="chapter-item expanded "><a href="memory_management/index.html"><strong aria-hidden="true">3.</strong> Memory Management</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="memory_management/fixed_partitioning.html"><strong aria-hidden="true">3.1.</strong> Fixed Partitioning</a></li><li class="chapter-item expanded "><a href="memory_management/dynamic_partitioning.html"><strong aria-hidden="true">3.2.</strong> Dynamic Partitioning</a></li><li class="chapter-item expanded "><a href="memory_management/buddy_system.html"><strong aria-hidden="true">3.3.</strong> Buddy System</a></li><li class="chapter-item expanded "><a href="memory_management/paging.html"><strong aria-hidden="true">3.4.</strong> Paging</a></li><li class="chapter-item expanded "><a href="memory_management/segmentation.html"><strong aria-hidden="true">3.5.</strong> Segmentation</a></li></ol></li><li class="chapter-item expanded "><a href="virtual_memory/index.html"><strong aria-hidden="true">4.</strong> Virtual Memory</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="virtual_memory/preliminary_concepts.html"><strong aria-hidden="true">4.1.</strong> Preliminary Concepts</a></li><li class="chapter-item expanded "><a href="virtual_memory/replacement_policy/index.html"><strong aria-hidden="true">4.2.</strong> Replacement Policy</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="virtual_memory/replacement_policy/local_replacement.html"><strong aria-hidden="true">4.2.1.</strong> Local Replacement</a></li><li class="chapter-item expanded "><a href="virtual_memory/replacement_policy/global_replacement.html"><strong aria-hidden="true">4.2.2.</strong> Global Replacement</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="processes_and_threads/index.html"><strong aria-hidden="true">5.</strong> Processes and Threads</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="processes_and_threads/processes.html"><strong aria-hidden="true">5.1.</strong> Process</a></li><li class="chapter-item expanded "><a href="processes_and_threads/threads.html"><strong aria-hidden="true">5.2.</strong> Threads</a></li><li class="chapter-item expanded "><a href="processes_and_threads/control.html"><strong aria-hidden="true">5.3.</strong> Control</a></li><li class="chapter-item expanded "><a href="processes_and_threads/schedule_and_dispatch.html"><strong aria-hidden="true">5.4.</strong> Schedule and Dispatch</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="overview"><a class="header" href="#overview">Overview</a></h1>
<h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<h1 id="exception-handling"><a class="header" href="#exception-handling">Exception Handling</a></h1>
<h1 id="hardware-interrupt"><a class="header" href="#hardware-interrupt">Hardware Interrupt</a></h1>
<h1 id="exception"><a class="header" href="#exception">Exception</a></h1>
<h1 id="system-call"><a class="header" href="#system-call">System Call</a></h1>
<h1 id="memory-management"><a class="header" href="#memory-management">Memory Management</a></h1>
<h1 id="fixed-partitioning"><a class="header" href="#fixed-partitioning">Fixed Partitioning</a></h1>
<h1 id="dynamic-partitioning"><a class="header" href="#dynamic-partitioning">Dynamic Partitioning</a></h1>
<h1 id="buddy-system"><a class="header" href="#buddy-system">Buddy System</a></h1>
<h1 id="paging"><a class="header" href="#paging">Paging</a></h1>
<h1 id="segmentation"><a class="header" href="#segmentation">Segmentation</a></h1>
<h1 id="virtual-memory"><a class="header" href="#virtual-memory">Virtual Memory</a></h1>
<h1 id="preliminary-concepts"><a class="header" href="#preliminary-concepts">Preliminary Concepts</a></h1>
<h1 id="replacement-policy"><a class="header" href="#replacement-policy">Replacement Policy</a></h1>
<h1 id="local-replacement"><a class="header" href="#local-replacement">Local Replacement</a></h1>
<h2 id="basic-algorithms"><a class="header" href="#basic-algorithms">Basic Algorithms</a></h2>
<h3 id="optimal"><a class="header" href="#optimal">Optimal</a></h3>
<ul>
<li>Selects for replacement that page for which the time to the next reference is the longest.</li>
<li>Impossible to implement</li>
<li>Benchmark algorithm</li>
</ul>
<h3 id="least-recently-used-lru"><a class="header" href="#least-recently-used-lru">Least recently used (LRU)</a></h3>
<ul>
<li>Replaces the page in memory that has not been referenced for the long time.</li>
<li>Does nearly as well as the optimal policy.</li>
<li>Implement by linked list or stack, ordered by visit time, with high time complexity.</li>
</ul>
<h3 id="first-in-first-out-fifo"><a class="header" href="#first-in-first-out-fifo">First-in-first-out (FIFO)</a></h3>
<ul>
<li>Process as a circular buffer</li>
<li>May cause <em>belady anomaly</em></li>
<li>Easy to implement</li>
</ul>
<h3 id="clock"><a class="header" href="#clock">Clock</a></h3>
<ul>
<li>Organize frames in a circular buffer.</li>
<li>First loaded or subsequently referenced, use bit = 1.</li>
<li>When replace, find a frame with use bit = 0, and reset use bit of frames that each scan encounters to 0.</li>
<li>If all of the frames have a use bit of 1, then the pointer will make one complete cycle through the buffer, setting all the use bits to 0, and stop at its original position, replacing the page in that frame.</li>
<li>An implementation of LRU using FIFO mechanism.</li>
</ul>
<h3 id="example"><a class="header" href="#example">Example</a></h3>
<p><img src="virtual_memory/replacement_policy/./assets/algorithm_compare.png" alt="Algorithm Compare" /></p>
<h2 id="infrequent-algorithms"><a class="header" href="#infrequent-algorithms">Infrequent Algorithms</a></h2>
<h3 id="improved-clock"><a class="header" href="#improved-clock">Improved Clock</a></h3>
<ol>
<li>Not accessed recently, not modified (u = 0; m = 0)</li>
<li>Accessed recently, not modified (u = 1; m = 0)</li>
<li>Not accessed recently, modified (u = 0; m = 1)</li>
<li>Accessed recently, modified (u = 1; m = 1)</li>
</ol>
<ul>
<li>Beginning at the current position of the pointer, scan the frame buffer. During
this scan, make no changes to the use bit. The first frame encountered with
(u = 0; m = 0) is selected for replacement.</li>
<li>If step 1 fails, scan again, looking for the frame with (u = 0; m = 1). The first
such frame encountered is selected for replacement. During this scan, set the
use bit to 0 on each frame that is bypassed.</li>
<li>If step 2 fails, the pointer should have returned to its original position and all
of the frames in the set will have a use bit of 0. Repeat step 1 and, if necessary,
step 2. This time, a frame will be found for the replacement.</li>
</ul>
<p>In brief, the transitions of each state are shown in the table below,</p>
<table><thead><tr><th align="center">Use Bit</th><th align="center">Modify Bit</th><th align="center">Next State</th></tr></thead><tbody>
<tr><td align="center">0</td><td align="center">0</td><td align="center">swap</td></tr>
<tr><td align="center">0</td><td align="center">1</td><td align="center">0 0</td></tr>
<tr><td align="center">1</td><td align="center">0</td><td align="center">0 0</td></tr>
<tr><td align="center">1</td><td align="center">1</td><td align="center">0 1</td></tr>
</tbody></table>
<h3 id="least-frequently-used"><a class="header" href="#least-frequently-used">Least Frequently Used</a></h3>
<ul>
<li>Replace the block in the set that has experienced the fewest references.</li>
<li>could be implemented by associating a counter with each block.</li>
<li>When a block is brought in, it is assigned a count of 1; with each reference to the block, its count is incremented by 1. When replacement is required, the block with the smallest count is selected.</li>
<li>Make poor replacement choices when certain blocks are referenced relatively infrequently overall, but frequently in some short intervals.</li>
</ul>
<h2 id="belady-anomaly"><a class="header" href="#belady-anomaly">Belady Anomaly</a></h2>
<p>Conflicts between the FIFO algorithm and the memory dynamic feature.</p>
<h1 id="global-replacement"><a class="header" href="#global-replacement">Global Replacement</a></h1>
<p>A global replacement policy considers all unlocked pages in main memory as candidates for replacement, regardless of which process owns a particular page.</p>
<h2 id="working-set-strategy"><a class="header" href="#working-set-strategy">Working Set Strategy</a></h2>
<ul>
<li>
<p>Working Set: The working set with parameter $\Delta$ for a process at virtual time $t$, which we designate as $W(t, \Delta)$, is the set of pages of that process that have been referenced in the last $\Delta$ virtual time units.</p>
</li>
<li>
<p>Resident Set:</p>
</li>
<li>
<p>Algorithm</p>
</li>
</ul>
<h2 id="relation-between-page-size-and-page"><a class="header" href="#relation-between-page-size-and-page">Relation between Page Size and Page</a></h2>
<h1 id="processes-and-threads"><a class="header" href="#processes-and-threads">Processes and Threads</a></h1>
<h1 id="processes"><a class="header" href="#processes">Processes</a></h1>
<h2 id="concepts"><a class="header" href="#concepts">Concepts</a></h2>
<h3 id="structure"><a class="header" href="#structure">Structure</a></h3>
<ul>
<li>代码</li>
<li>数据</li>
<li>状态寄存器：CR0, IP</li>
<li>通用寄存器：AX, BX, CX</li>
<li>An associated set of system resources</li>
</ul>
<h3 id="feature"><a class="header" href="#feature">Feature</a></h3>
<ul>
<li>动态性</li>
<li>并发性</li>
<li>独立性</li>
<li>制约性</li>
</ul>
<h3 id="relation-between-programs"><a class="header" href="#relation-between-programs">Relation between programs</a></h3>
<p>Abstract of Programs in executive states<br />
Program = Static executive file<br />
Process = Program + executive states<br />
A program may own different process</p>
<h2 id="process-control-block"><a class="header" href="#process-control-block">Process Control Block</a></h2>
<p>操作系统用 PCB 来进程的基本状态</p>
<h3 id="基本状态"><a class="header" href="#基本状态">基本状态</a></h3>
<p>包含：</p>
<ul>
<li>进程的标识信息</li>
<li>处理机现场保存</li>
<li>进程的控制信息</li>
</ul>
<p>At any given point in time, while the program is executing, this process can be uniquely characterized by a number of elements, including the following:</p>
<ul>
<li>Identifier: A unique identifier associated with this process, to distinguish it from all other processes.</li>
<li>State: If the process is currently executing, it is in the running state.</li>
<li>Priority: Priority level relative to other processes.</li>
<li>Program counter: The address of the <em>next instruction</em> in the program to be executed.</li>
<li>Memory pointers: Include pointers to the program code and data associated
with this process, plus any memory blocks shared with other processes.</li>
<li>Context data: These are data that are present in registers in the processor while the process is executing.</li>
<li>I/O status information: Includes outstanding I/O requests, I/O devices assigned to this process, a list of files in use by the process, and so on.</li>
<li>Accounting information: May include the amount of processor time and clock time used, time limits, account numbers, and so on.</li>
</ul>
<h3 id="控制信息"><a class="header" href="#控制信息">控制信息</a></h3>
<ul>
<li>
<p>调度和状态信息： 调度进程和处理及使用情况</p>
</li>
<li>
<p>进程间通信信息： 进程间通信相关的各种标识</p>
</li>
<li>
<p>储存管理信息</p>
</li>
<li>
<p>进程所用资源</p>
</li>
<li>
<p>有关数据结构的连接信息</p>
</li>
</ul>
<h3 id="组织形式"><a class="header" href="#组织形式">组织形式</a></h3>
<ul>
<li>链表：同一状态进程的 PCB 组成链表</li>
<li>索引表：统一状态进程的 PCB 被同一索引指向</li>
</ul>
<h2 id="process-states"><a class="header" href="#process-states">Process States</a></h2>
<h3 id="creation"><a class="header" href="#creation">Creation</a></h3>
<p>When a new process is to be added to those currently being managed, the OS builds the data structures used to manage the process, and allocates address space in main memory to the process.</p>
<h4 id="reasons"><a class="header" href="#reasons">Reasons</a></h4>
<ul>
<li>New batch job</li>
<li>Created by OS to provide a service</li>
<li>Interactive log-on</li>
<li>Spawned by existing process</li>
</ul>
<h3 id="ready"><a class="header" href="#ready">Ready</a></h3>
<h3 id="blockedwaiting"><a class="header" href="#blockedwaiting">Blocked/Waiting</a></h3>
<p>A process that cannot execute until some event occurs, such as the completion of an I/O operation.</p>
<h4 id="reasons-1"><a class="header" href="#reasons-1">Reasons</a></h4>
<ul>
<li>请求并等 待系统服务</li>
<li>启动某种操作无法马上完成</li>
<li>需要的数据没有到达</li>
</ul>
<h3 id="强占"><a class="header" href="#强占">强占</a></h3>
<p>高优先级进程就绪
进程运行时间已结束</p>
<h3 id="唤醒"><a class="header" href="#唤醒">唤醒</a></h3>
<h3 id="结束"><a class="header" href="#结束">结束</a></h3>
<p>正常/错误/致命错误/被其他进程所杀</p>
<p>操作系统在 <strong>中断</strong> 中处理进程<br />
以 <em>Sleep()</em> 为例，创建 -&gt; 就绪 -&gt; 运行 -&gt; 等待 -&gt; 操作系统时钟中断 ...</p>
<p>Running, ready and blocked states are three basic states.<br />
Five-state Process Module: New, ready, running, blocked and exit.</p>
<p>等待状态结束后重新回到就绪队列。</p>
<h2 id="suspended-processes"><a class="header" href="#suspended-processes">Suspended Processes</a></h2>
<p>把一个进程从内存转到外存，低优先级让位高优先级。</p>
<ul>
<li>等待挂起 (Block-suspend)</li>
<li>就绪挂起 (Ready-suspend)</li>
</ul>
<h2 id="activated-processes"><a class="header" href="#activated-processes">Activated Processes</a></h2>
<p>把一个进程从外存转到内存</p>
<p>就绪挂起 -&gt; 就绪：没有就绪进程或挂起或有高优先级的挂起进程<br />
等待挂起 -&gt; 等待</p>
<h2 id="state-queue"><a class="header" href="#state-queue">State Queue</a></h2>
<p>根据不同优先级，就绪队列和等待队列可能有多个。</p>
<h1 id="threads"><a class="header" href="#threads">Threads</a></h1>
<p>多进程的问题：</p>
<ol>
<li>如何通信、如何共享数据</li>
<li>系统开销较大，涉及进程的创建、进程的终止等</li>
</ol>
<h2 id="concepts-1"><a class="header" href="#concepts-1">Concepts</a></h2>
<p>线程是进程的一部分，描述指令流执行状态，它是进程中指令执行流的最小单位，是 CPU 调度的基本单位。
<strong>堆栈 (Heap) 资源不能共享</strong>
线程是资源调度的基本单位，因此同一个进程内的线程共享其资源。</p>
<h2 id="features"><a class="header" href="#features">Features</a></h2>
<ol>
<li>Resource ownership: A process includes a virtual address space to hold the process image; The process image is the collection of program, data, stack, and attributes defined in the process control block. From time to time, a process may be allocated control or ownership of resources,such as main memory, I/O channels, I/O devices, and files. The OS performs a protection function to prevent unwanted interference between processes with respect to resources.</li>
<li><strong>Scheduling/execution</strong>: The execution of a process follows an execution path (trace) through one or more programs. This execution maybe interleaved with that of other processes. Thus, a process has an execution state (Running, Ready, etc.) and a dispatching priority, and is the entity that is scheduled and dispatched by the OS.</li>
</ol>
<h2 id="pros-and-cons"><a class="header" href="#pros-and-cons">Pros and Cons</a></h2>
<p>优点：</p>
<ol>
<li>一个进程同时存在线程。</li>
<li>多线程之间可以并发。</li>
<li>线程间共享地址空间和文件等资源。</li>
</ol>
<p>缺点：一个进程崩溃，其他进程也会崩溃。</p>
<center>
<p><img src="processes_and_threads/./assets/multithreading.png" alt="multithreading" /></p>
</center>
<h2 id="implementation-methods"><a class="header" href="#implementation-methods">Implementation Methods</a></h2>
<ul>
<li>User-Level threads: 用户级的线程库函数来完成线程的管理</li>
<li>Kernel-Level threads</li>
<li>Lightweight Process</li>
</ul>
<h3 id="user-level-threads"><a class="header" href="#user-level-threads">User-Level Threads</a></h3>
<ul>
<li>不依赖于操作系统</li>
<li>在用户空间实现线程机制</li>
<li>同一进程内的用户线程切换速度快</li>
<li>允许每个进程拥有自己的线程调度算法</li>
</ul>
<p>不足：</p>
<ul>
<li>线程发起系统调用而阻塞时，整个线程进入等待。</li>
<li>不支持基于线程的<em>处理机</em>抢占，除非当前运行线程主动放弃</li>
<li>只能按进程分配 CPU 时间</li>
</ul>
<h2 id="kernel-level-threads"><a class="header" href="#kernel-level-threads">Kernel-Level Threads</a></h2>
<p>由<strong>内核</strong>通过系统调用实现的线程机制，由<strong>内核</strong>实现线程的创建、终止和管理。</p>
<p>特点：</p>
<ul>
<li>由内核维护 PCB 和 TCB</li>
<li>线程执行系统调用而被阻塞不影响其他线程</li>
<li>线程的创建、终止和切换相对较大：因为在内核中实现</li>
<li>基于线程数量的时间分配：线程数量多的进程 CPU 执行时间多</li>
</ul>
<h3 id="lightweight-process"><a class="header" href="#lightweight-process">Lightweight Process</a></h3>
<p>内核支持的用户线程，一个进程可有一个或多个轻量级进程，每个 Lightweight 进程由一个<strong>单独的内核进程</strong>（即内核线程池）来支持，线程由内核线程池（独立内核进程）执行，但线程与内核线程池之间未绑定。</p>
<h1 id="control"><a class="header" href="#control">Control</a></h1>
<h2 id="switch-processes"><a class="header" href="#switch-processes">Switch Processes</a></h2>
<ul>
<li>暂停当前运行进程，从运行状态变为其他状态</li>
<li>调度另一个进程从就绪状态变为运行状态</li>
</ul>
<p>When to Switch Processes:</p>
<ul>
<li>Clock interrupt</li>
<li>I/O interrupt</li>
<li>Memory fault</li>
</ul>
<h3 id="要求"><a class="header" href="#要求">要求</a></h3>
<ul>
<li>切换前，保存进程上下文（保存至 PCB）</li>
<li>切换后，恢复进程上下文</li>
<li>快速切换</li>
</ul>
<h3 id="进程生命周期的信息"><a class="header" href="#进程生命周期的信息">进程生命周期的信息</a></h3>
<ul>
<li>代码</li>
<li>数据</li>
<li>状态寄存器：CR0, IP</li>
<li>通用寄存器：AX, BX, CX</li>
<li>An associated set of system resources</li>
</ul>
<h3 id="上下文切换"><a class="header" href="#上下文切换">上下文切换</a></h3>
<p>以进程 P0、进程 P1 为例：<br />
P0 -- 中断或系统调用 -- P0 保存 -- P1 恢复 -- P1 -- 中断或系统调用 -- P1 保存 -- P0 恢复 -- P0</p>
<h1 id="schedule-and-dispatch"><a class="header" href="#schedule-and-dispatch">Schedule and Dispatch</a></h1>
<h2 id="调度"><a class="header" href="#调度">调度</a></h2>
<ul>
<li>进程切换： CPU 资源占用者的切换</li>
<li>处理机调度：从就绪队列中挑选下个占用 CPU 资源的 <strong>进程</strong>，从多个 CPU 中挑选就绪进程可用的 CPU 资源</li>
<li>调度形式：非抢占式系统、可抢占系统</li>
<li>调度策略：如何从就绪队列中选择下一个执行进程</li>
</ul>
<h2 id="principles-of-scheduling-algorithms"><a class="header" href="#principles-of-scheduling-algorithms">Principles of Scheduling Algorithms</a></h2>
<ul>
<li>CPU 使用率：处于忙状态的<strong>时间百分比</strong></li>
<li>吞吐量：单位时间完成的<strong>进程数量</strong></li>
<li>周转时间：进程从初始化到结束的<strong>总时间</strong></li>
<li>等待时间：进程在就绪队列的总时间</li>
<li>响应时间：从提交请求到产生相应所花费的时间
<em>带宽和延迟不可兼得</em></li>
</ul>
<h2 id="处理机调度策略的相应时间目标"><a class="header" href="#处理机调度策略的相应时间目标">处理机调度策略的相应时间目标</a></h2>
<ul>
<li>减少响应时间</li>
<li>减少平均响应时间的波动（操作系统的计算延迟）</li>
</ul>
<h2 id="处理机调度策略的吞吐量目标"><a class="header" href="#处理机调度策略的吞吐量目标">处理机调度策略的吞吐量目标</a></h2>
<ul>
<li>增加吞吐量：
<ul>
<li>减少开销</li>
<li>系统资源的高效开销</li>
</ul>
</li>
<li>减少等待时间
<ul>
<li>减少每个进程的等待时间</li>
</ul>
</li>
<li>操作系统需要保证吞吐量不受用户交互的影响</li>
</ul>
<h2 id="处理机调度的公平性目标"><a class="header" href="#处理机调度的公平性目标">处理机调度的公平性目标</a></h2>
<p><em>公平不等于公正（例如：富人和穷人缴同等额度的税）</em></p>
<ul>
<li>保证每个进程占用相同的 CPU 的时间</li>
<li>保证每个进程的等待时间相同</li>
<li>公平通常会增加平均响应时间，降低效率</li>
</ul>
<h2 id="调度算法"><a class="header" href="#调度算法">调度算法</a></h2>
<ul>
<li>
<p>先来先服务算法：依据进程进入就绪状态的先后顺序排列（超市结账排队）</p>
<ul>
<li>优点：简单</li>
<li>缺点：
<ul>
<li>平均等待时间波动较大：短进程可能排在长进程后面；</li>
<li>I/O 和 CPU 资源利用较低：CPU 密集进程不使用 I/O，I/O 密集进程不使用 CPU</li>
</ul>
</li>
</ul>
</li>
<li>
<p>短进程优先算法：选择就绪队列中执行时间最短的进程占用 CPU 进入运行状态</p>
<ul>
<li>就绪队列按预期的执行时间来排序</li>
<li>具有最优平均周转时间</li>
<li>连续的段进程流会使长进程无法获得 CPU 资源，对长进程不公平</li>
<li>需要预估下一个 CPU 计算的持续时间（问用户），欺骗就杀死 or 基于历史的记录学习（动量梯度下降） $t_i = \alpha t_i + (1-\alpha)\tau_{i-1}$</li>
</ul>
</li>
<li>
<p>最高响应比优先算法<br />
选择就绪队列中相应比 R 值最高的进程
$$R = (w+s)/s$$</p>
<ul>
<li>w: waiting time</li>
<li>s: service time</li>
</ul>
<p>在短进程有限的基础上进行改进；不可抢占；关注进程的等待时间；防止无限期推迟</p>
</li>
<li>
<p>时间片轮转算法</p>
<ul>
<li>时间片： 分配处理及资源的基本时间单位</li>
<li>算法思路：时间片结束后，按 FCFS (First come, first service) 算法切换到下一个就绪进程；每隔 $n-1$ 个时间片进程执行一个时间片 q</li>
<li>举例：P1-53, P2-8, P3-68, P4-24 （时间片为20）<br />
P1 0-20，P2 20-28，P3 28-48，P4 48-68（P2 已结束）<br />
P1 68-88，P3 88-108，P4 108-112 （P4 已结束）<br />
P1 112-125，P3 125-145 （P1 已结束）<br />
P3 145-153 （P3已结束）<br />
等待时间 $\begin{aligned}
P1 &amp;= (68-20) + (112-88) = 72 \
P2 &amp;= (20-0) = 20 \
P3 &amp;= (28-0)+(88-48)+(125-108)+(145-145) = 85 \
P4 &amp;= (48-0)+(108-68)=88 \
\end{aligned}$
平均等待时间：$(72+20+85+88)/4 = 66.25$</li>
<li>时间片太大：等待时间太长</li>
<li>时间片太小：开销太大</li>
</ul>
</li>
<li>
<p>多级队列调度算法</p>
<ul>
<li>就绪队列被划分为几个对立的子队列，是上述几种算法的综合</li>
<li>每个队列都有自己的调度策略</li>
<li>队列之间的调度：
<ul>
<li>固定优先级</li>
<li>时间片轮转</li>
</ul>
</li>
<li>多级反馈队列算法
<ul>
<li>进程可在不同队列间移动的多级队列算法</li>
<li>CPU 密集型进程优先级下降得很快</li>
<li>对 I/O 密集型进程有利</li>
</ul>
</li>
</ul>
</li>
<li>
<p>公平共享调度算法</p>
<ul>
<li>公平共享调度控制用户对系统资源的访问</li>
</ul>
</li>
</ul>
<h2 id="实时操作系统"><a class="header" href="#实时操作系统">实时操作系统</a></h2>
<ul>
<li>
<p>定义:正确性依赖于其 <strong>时间</strong> 和 <strong>功能</strong> 两方面的操作系统</p>
</li>
<li>
<p>实时操作系统的性能指标</p>
<ul>
<li>时间约束的及时性</li>
<li>速度和平均性能相对不重要</li>
</ul>
</li>
<li>
<p>分类</p>
<ul>
<li>强实时操作系统
<ul>
<li>要求在指定时间内必须完成重要的任务</li>
</ul>
</li>
<li>弱实时操作系统
<ul>
<li>重要进程有高优先级</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Hard deadline: 错过任务实现会导致灾难性后果;必须验证,在最坏的情况下能够满足实现</p>
</li>
<li>
<p>Soft deadline: 通常能满足任务时限;尽力保证满足任务时限</p>
</li>
<li>
<p>可调度性: 表示一个实时操作系统能够满足任务时限要求</p>
</li>
<li>
<p>实时调度算法</p>
<ul>
<li>速率单调调度算法: 通过 <strong>周期</strong> 安排优先级,周期越短优先级越高</li>
<li>最早截止时间优先算法: 截止时间越早优先级越高</li>
</ul>
</li>
<li>
<p>多处理器调度</p>
<ul>
<li>多个处理机组成一个多处理器系统</li>
<li>处理机间可负载共享</li>
<li>对称多处理机的进程分配:
<ul>
<li>静态进程分配</li>
<li>动态进程分配</li>
</ul>
</li>
<li>优先级反置: 操作系统中出现高优先级进程长时间等待低优先级进程所占用资源的现象
<ul>
<li>解决方法: 优先级继承、优先级天花板协议</li>
</ul>
</li>
</ul>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        <script type="text/javascript" src="mermaid.min.js"></script>
        
        <script type="text/javascript" src="mermaid-init.js"></script>
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
